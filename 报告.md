# 课程项目报告：精调项目A + 复刻流程与项目B + 总结报告

## 1. 项目A：系统概述与工程实现

### 1.1 项目简介与定位

项目 A 为 Our-12306-CS3604 铁路订票系统，采用前后端分离架构，并以测试驱动开发（TDD）组织研发与回归验证。该项目属于“精调项目A”，允许为满足测评与功能正确性进行必要的人工修改，并以 GUI 自动化测试作为最终验收手段之一。

### 1.2 技术栈与项目结构

- 前端：React + TypeScript + Vite，测试框架为 Vitest 与 React Testing Library。
- 后端：Node.js + Express + SQLite，测试框架为 Jest 与 Supertest，使用 JWT 进行身份认证。
- CI：GitHub Actions 用于自动化测试与持续集成（PR 合并前必须通过测试）。
- 项目结构：包含 backend / frontend / requirements / 等核心目录。

------

## 2. 需求管理：规模、结构与演进机制

### 2.1 两层需求文档体系

为兼顾“可追溯、可复刻、可自动开发”，本项目采用“两层需求文档”：

- **初始需求文档（YAML）**：由团队整理，覆盖详细需求场景，并显式定义交互过程以及需要的页面整体截图与组件截图位置。注意交互过程要求已通过手动操作确认流程正确。
- **生成需求文档（最终需求文档）**：由 agent 在浏览目标页面、截图、提取 CSS 与 TSX 信息后生成；生成文档可直接作为后续自动开发（interface_designer）的输入。

需求文档组织方式均以“页面”为单位组织；页面内部以“功能组件”为单位树状组织。

### 2.2 迭代与新增需求的处理策略

在课程更关注“迭代与新增需求”的背景下，本项目将新增需求纳入同一流水线处理：

- 新增需求首先以 YAML 形式进入“初始需求文档层”；
- 由 agent 重新对目标页面执行“证据采集（截图/结构/样式）→最终需求文档更新”；
- 后续自动开发与测试更新基于最新的最终需求文档执行

------

## 3. 复刻流程：从需求输入到可复刻产物（用于项目B/C）

本节给出可交付给助教用于复刻项目 C 的**智能体使用流程**描述。

### 3.1 角色分工与工具链

复刻流程由以下 agent&提示词模块组成：

1. **ui-analyzer-prompt-simplified**：负责打开网页并进行页面/组件截图采集；需要用户手动将网页设置为全屏，并在组件特写截图完成后检查质量，若截图有误需指出并纠正。
> user prompt：新增需求：[initial-requirement.yaml]，请开始工作

2. **interface_designer**：输入user prompt后，可全自动完成开发。

   > user prompt：新增需求：[ui-requirements.yaml][ui-style-guide.md]，请开始工作

3. **tdd_developer_prompt**：输入user prompt后可全自动完成开发；开发完成后仍需要用户手动登录网站验证最终效果。

   > user prompt：新增需求：[ui-requirements.yaml][ui-style-guide.md]，请开始工作

其他注意事项：均使用 opus 4.5 max mode；并需要 browser MCP 与任务队列 MCP 来组织执行；同时保证网络稳定性，网络断连会影响生成质量。

### 3.2 当前复刻能力小结

基于现阶段实验结论：

- 静态组件复现效果可达到约 90%；
- 动态组件（如报错提示）复现效果相对较弱，UI 样式可能存在差异，但功能可正确复现。

------

## 4. 项目A测试体系与通过率

### 4.1 TDD 测试方法与测试金字塔

项目A严格遵循 TDD 三阶段（Red/Green/Refactor）。

在测试组织层面，项目采用**测试金字塔模型**进行分层设计：

- **单元测试（Unit Tests）**：主要覆盖后端核心业务逻辑、数据校验规则与状态转换函数，确保最小功能单元的正确性；
- **集成测试（Integration Tests）**：覆盖接口层逻辑，包括路由、鉴权、中间件与数据库交互，验证模块间协作是否符合预期；
- **端到端测试（End-to-End Tests）**：在前端侧验证完整用户操作流程，确保系统在真实使用场景下的稳定性。

### 4.2 后端测试执行结果

后端测试采用 Jest 与 Supertest 框架，重点覆盖以下内容：

- 用户注册、登录与身份鉴权流程；
- 购票、查询、订单管理等核心业务接口；
- 异常输入与非法状态下的容错与错误处理逻辑。

测试执行命令为：

```
cd backend && npm test
```

测试结果如下：

- **测试套件（test suites）**：17 个
- **测试用例（tests）**：371 个
- **失败用例**：0
- **总执行时间**：约 154 秒

上述结果表明，后端业务逻辑在当前需求约束下具有良好的完整性与稳定性，同时测试集规模足以支撑后续需求扩展与功能回归验证。

------

### 4.3 前端测试执行结果

前端测试基于 Vitest 与 React Testing Library 实现，主要覆盖以下方面：

- 组件级渲染与状态更新逻辑；
- 用户交互行为（点击、输入、选择等）；
- 页面级流程跳转与条件渲染逻辑。

测试执行命令为：

```
cd frontend && npm test -- --run
```

测试结果如下：

- **测试文件（test files）**：48 个
- **测试用例（tests）**：674 个
- **失败用例**：0
- **总执行时间**：约 50.64 秒

前端测试重点关注“功能行为正确性”而非纯视觉一致性，这一策略有效降低了测试对 UI 微调的敏感度，为后续精调与 GUI 自动化测试留出了工程空间。

------

### 4.4 总体测试通过率与工程意义

综合前后端测试结果：

- **测试文件总数**：65 个
- **测试用例总数**：1045 个
- **失败用例**：0
- **总体通过率**：100%

------

## 5. GUI 自动化测试

### 5.1 GUI 测试结果

GUI 自动化测试共 30 项，全部通过；界面达到与原 12306 网站截图“像素级复刻”的效果描述。

### 5.2 为适配 GUI 测试口径进行的项目级调整

为保证测评口径一致，项目对以下细节做了对齐或简化（不改变核心业务语义）：

1. 提醒信息（remind info）调整为与原网站完全匹配。
2. 注册逻辑口径：先检查是否勾选协议，再检查信息有效性；任一无效统一提示“请填写完整信息！”。
3. 车次筛选逻辑口径：勾选 “D-动车” 后自动过滤（无需再次点击“查询”）。
4. 测试数据集简化：仅重建 3 天车次数据，因此 GUI 测试中调整了选择日期。

------

## 6. 结论：面向课程三项提交要求的完成情况

1. **精调项目A**：已形成稳定可验证版本，并以 TDD 测试与 GUI 自动化测试提供证据链：

- TDD：1045/1045 通过。
- GUI：30/30 通过，且记录了与测评口径对齐的必要调整与工具规避策略。

2. **复刻流程 + 项目B**：已形成可复用的复刻流水线，并明确输入接口（初始需求 YAML / 最终需求 YAML + 风格规范）、agent 分工、关键人工介入点与能力边界，可供助教用于复刻项目C。

3. **报告**：本报告已覆盖需求管理、需求规模/组织方式、智能体参与模块设计与测试撰写、以及最终测试通过率等汇报要点，并给出可直接用于复刻验收的流程化描述。