# 车次列表页使用指南

## 🚀 快速开始

### 1. 启动服务

```bash
# 终端1: 启动后端服务
cd backend
npm run dev
# 服务运行在 http://localhost:3000

# 终端2: 启动前端服务  
cd frontend
npm run dev
# 服务运行在 http://localhost:5173
```

### 2. 访问页面

打开浏览器访问: **http://localhost:5173/trains**

---

## 📋 功能使用

### 查询车次

1. **选择出发城市**
   - 点击"出发城市"输入框
   - 从下拉列表中选择城市，或直接输入城市名
   - 支持的城市: 北京、上海、广州、深圳、杭州、南京等16个城市

2. **选择到达城市**
   - 点击"目的城市"输入框
   - 从下拉列表中选择目的地

3. **选择出发日期**
   - 默认为当前日期
   - 点击日期输入框修改（目前为简化实现）

4. **点击查询按钮**
   - 系统将在100ms内返回查询结果
   - 车次列表自动更新

### 筛选车次

查询结果返回后，可使用多维度筛选：

#### 车次类型筛选
- **GC-高铁/城际**: G字头、C字头车次
- **D-动车**: D字头车次
- **其他类型**: Z(直达)、T(特快)、K(快速)等

点击复选框勾选/取消，支持多选。

#### 发车时间筛选
- 点击"发车时间"下拉框
- 选择时间段:
  - 00:00--24:00 (全部)
  - 00:00--06:00 (凌晨)
  - 06:00--12:00 (上午)
  - 12:00--18:00 (下午)
  - 18:00--24:00 (晚上)

#### 车站筛选
- **出发车站**: 筛选指定出发站的车次
- **到达车站**: 筛选指定到达站的车次

#### 席别筛选
- 商务座
- 一等座
- 二等座
- 软卧
- 硬卧
- 硬座
- 无座

勾选后只显示有该席别可用的车次。

#### 日期快捷选择
- 点击顶部日期按钮(1-16, 1-17等)快速切换查询日期

#### 应用筛选
- 所有筛选条件实时生效
- 车次列表自动更新
- 右下角显示"筛选"按钮（橙色）

### 查看车次详情

- 点击车次号（如G12、D9）
- 弹出车次详情窗口
- 显示停靠站信息（目前为骨架实现）

### 预订车票

- 点击车次行最右侧的"预订"按钮
- 有票时按钮为橙色可点击
- 无票时按钮为灰色不可点击
- 预订流程（待实现）

---

## 💡 使用技巧

### 1. 快速查询常用线路

系统默认查询"北京 → 上海"线路，页面加载时自动显示结果。

### 2. 组合筛选

可同时使用多个筛选条件，例如:
- 勾选"GC-高铁/城际" + 勾选"商务座"
- 结果: 只显示有商务座可用的高铁车次

### 3. 查看余票状态

余票显示规则:
- **绿色"有"**: 余票≥20张
- **黑色数字**: 余票<20张，显示具体数量
- **灰色"无"**: 已售罄
- **灰色"--"**: 该车次无此席别

### 4. 理解车次类型

车次号徽章显示:
- **高**: 高铁(G/C字头)
- **动**: 动车(D字头)
- **直**: 直达(Z字头)
- **特**: 特快(T字头)
- **快**: 快速(K字头)

---

## 🧪 测试数据

### 可用城市 (16个)
北京、上海、广州、深圳、杭州、南京、武汉、成都、重庆、西安、天津、苏州、郑州、长沙、沈阳、青岛

### 可用车次 (6个)
- **G1**: 北京南 → 上海虹桥, 08:00-12:30, 04:30
- **G3**: 北京南 → 上海虹桥, 09:00-13:28, 04:28
- **G5**: 北京南 → 上海虹桥, 10:00-14:35, 04:35
- **G12**: 北京南 → 上海虹桥, 14:10-18:41, 04:31
- **D9**: 北京南 → 上海南, 19:36-12:24(次日), 16:48
- **D8**: 北京 → 上海, 20:10-08:10(次日), 12:00

### 测试账号
- **账号1**: testuser / password123
- **账号2**: admin / admin123

---

## 🔧 故障排查

### 问题: 页面加载失败
**解决方案**:
1. 检查后端服务是否运行 (http://localhost:3000/health)
2. 检查前端服务是否运行 (http://localhost:5173)
3. 清除浏览器缓存后重试

### 问题: 查询无结果
**解决方案**:
1. 确认输入的城市名称正确（必须完全匹配）
2. 检查是否有该线路的车次（目前只有北京-上海线路）
3. 查看浏览器控制台错误信息

### 问题: 筛选不生效
**解决方案**:
1. 确保先完成查询（有车次列表）
2. 检查筛选条件是否过于严格
3. 取消所有筛选重新尝试

---

## 📞 技术支持

### API端点
- 城市列表: `GET /api/trains/cities`
- 车次查询: `POST /api/trains/search`
- 车次详情: `GET /api/trains/:trainNumber/details`

### 数据库
- **类型**: SQLite
- **文件**: backend/database.db
- **重置数据**: `cd backend && node src/database/init_db.js`

### 日志查看
- **后端日志**: 查看后端终端输出
- **前端日志**: 打开浏览器开发者工具 (F12) → Console

---

## 🎯 功能状态

### ✅ 已完成
- 城市查询和下拉推荐
- 车次查询和结果显示
- 多维度筛选（车次类型、时间、车站、席别）
- 余票状态显示
- 错误提示和验证

### ⚠️ 部分实现
- 日期选择器（使用alert代替）
- 车次详情（返回模拟数据）
- 预订功能（按钮状态控制完成，流程待实现）

### ❌ 待实现
- 5分钟过期提示
- 登录状态检测
- 预订弹窗和流程
- 加载状态指示器

---

## 📚 相关文档

- [实现总结](./TRAIN_LIST_IMPLEMENTATION_SUMMARY.md)
- [需求文档](./requirements/train-list-page-ui-requirements.yaml)
- [样式指南](./requirements/train-list-page-ui-style-guide.md)
- [测试账号](./TEST_ACCOUNTS.md)

---

**更新时间**: 2026-01-16  
**版本**: 1.0.0  
**状态**: 可用于演示和测试 ✅
