---
name: 12306登录页架构设计
overview: 为12306登录页面设计完整的三层架构（UI/API/Logic），包含4个主要组件和15个交互场景的骨架代码实现。
todos:
  - id: init-mcp-queue
    content: 初始化MCP工具队列（init_top_down_queue）
    status: completed
  - id: create-project-structure
    content: 创建frontend/backend基础目录结构和配置文件
    status: completed
    dependencies:
      - init-mcp-queue
  - id: design-top-nav
    content: 设计并注册顶部导航组件（UI-TOP-NAV）
    status: completed
    dependencies:
      - create-project-structure
  - id: design-login-form
    content: 设计登录表单三层架构（UI/API/Logic），覆盖6个scenarios
    status: completed
    dependencies:
      - create-project-structure
  - id: design-bottom-nav
    content: 设计并注册底部导航组件（UI-BOTTOM-NAV）
    status: completed
    dependencies:
      - create-project-structure
  - id: design-sms-verification
    content: 设计短信验证三层架构（UI/2个API/2个Logic），覆盖9个scenarios
    status: completed
    dependencies:
      - create-project-structure
      - design-login-form
  - id: design-login-page
    content: 设计登录页面容器，组合所有子组件
    status: completed
    dependencies:
      - design-top-nav
      - design-login-form
      - design-bottom-nav
      - design-sms-verification
  - id: verify-interface-chain
    content: 验证所有接口调用链完整性（UI→API→Logic）
    status: completed
    dependencies:
      - design-login-page
---

# 12306登录页面架构设计

## 项目概述

基于 [`requirements/ui-requirements.yaml`](requirements/ui-requirements.yaml) 和 [`requirements/metadata.md`](requirements/metadata.md)，设计并实现12306登录页面的完整架构骨架代码。**技术栈**：

- 前端：React 18 + TypeScript + Vite + 传统CSS
- 后端：Node.js + Express + SQLite3
- 目录结构：参考 [`requirements/metadata.md`](requirements/metadata.md) 第2节

**核心要求**：

1. 严格按照 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 实现像素级UI复刻
2. 100%覆盖所有scenarios（REQ-LOGIN-FORM有6个、REQ-SMS-VERIFICATION有9个）
3. 实现完整的UI→API→Logic调用链
4. 每个接口都必须标注@scenarios和@features

---

## 实现步骤

### 阶段一：初始化

**1. 初始化MCP工具队列**

- 调用 `mcp_architect-manager_init_top_down_queue`
- 参数：
- `project_root`: `/Users/od/Desktop/ui_analyzer_agent_requirements`
- `requirements_path`: `/Users/od/Desktop/ui_analyzer_agent_requirements/requirements/ui-requirements.yaml`

**2. 创建项目基础目录结构**

```javascript
/root
├── backend/
│   ├── src/
│   │   ├── database/
│   │   ├── routes/
│   │   ├── utils/
│   │   └── index.js
│   └── package.json
├── frontend/
│   ├── src/
│   │   ├── components/
│   │   ├── pages/
│   │   ├── api/
│   │   └── App.tsx
│   └── package.json
```

---

### 阶段二：迭代设计（按需求优先级）

#### 需求1：REQ-TOP-NAV（顶部导航）

**UI层设计**：

- 文件：`frontend/src/components/TopNavigation.tsx` + `TopNavigation.css`
- 内容：
- Logo区域（图片：`/images/登录页-顶部导航区域-中国铁路Logo.png`）
- 欢迎文字："欢迎登录12306"
- CSS：复制 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 第3.3节样式
- 注册：`register_ui_component`
- `id`: UI-TOP-NAV
- `path`: frontend/src/components/TopNavigation.tsx
- `related_req_id`: REQ-TOP-NAV
- `downstream_ids`: [] (无下游调用)

---

#### 需求2：REQ-LOGIN-FORM（登录表单）⚡ **核心复杂**

**功能清单**（必须100%实现）：

- ✅ SCENARIO-001：校验用户名为空
- ✅ SCENARIO-002：校验密码为空
- ✅ SCENARIO-003：校验密码长度（<6位）
- ✅ SCENARIO-004：用户名未注册
- ✅ SCENARIO-005：密码错误
- ✅ SCENARIO-006：登录成功→弹出短信验证窗口

**UI层设计**：

- 文件：`frontend/src/components/LoginForm.tsx` + `LoginForm.css`
- State管理：
  ```typescript
      const [loginMode, setLoginMode] = useState<'account' | 'qrcode'>('account');
      const [username, setUsername] = useState('');
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
  ```




- 功能实现：
- 账号/扫码登录标签切换
- 用户名/密码输入框（带图标）
- 表单验证（所有6个scenarios）
- 错误提示显示
- "注册账号"和"忘记密码"链接
- CSS：复制 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 第4.3节样式
- 注册：`register_ui_component`
- `id`: UI-LOGIN-FORM
- `downstream_ids`: [API-LOGIN]

**API层设计**：

- 文件：`backend/src/routes/api.js`
- 接口：`POST /api/auth/login`
- 请求体：`{ username: string, password: string }`
- 响应体：`{ success: boolean, message: string, needVerification?: boolean }`
- 逻辑：调用 `FUNC-AUTHENTICATE-USER` 验证用户凭据
- 返回501 + Mock数据
- 注册：`register_api_endpoint`
- `id`: API-LOGIN
- `signature`: POST /api/auth/login
- `upstream_ids`: [UI-LOGIN-FORM]
- `downstream_ids`: [FUNC-AUTHENTICATE-USER]

**Logic层设计**：

- 文件：`backend/src/database/operations.js`
- 函数：`authenticateUser(username, password)`
- 数据库操作：`SELECT * FROM users WHERE username = ? OR email = ? OR phone = ?`
- 验证逻辑：检查密码、返回用户信息
- 注册：`register_backend_function`
- `id`: FUNC-AUTHENTICATE-USER
- `signature`: authenticateUser(username, password)
- `upstream_ids`: [API-LOGIN]
- `db_tables`: [users]

---

#### 需求3：REQ-BOTTOM-NAV（底部导航）

**UI层设计**：

- 文件：`frontend/src/components/BottomNavigation.tsx` + `BottomNavigation.css`
- 内容：
- 友情链接区域（图片：`/images/友情链接.png`）
- 4个二维码：中国铁路微信/微博、12306公众号、铁路12306
- 免责声明文字
- CSS：复制 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 第5.3节样式
- 注册：`register_ui_component`
- `id`: UI-BOTTOM-NAV
- `downstream_ids`: [] (无下游调用)

---

#### 需求4：REQ-SMS-VERIFICATION（短信验证）⚡ **高复杂度**

**功能清单**（必须100%实现）：

- ✅ SCENARIO-001：获取验证码-证件号错误
- ✅ SCENARIO-002：获取验证码-成功
- ✅ SCENARIO-003：获取验证码-频率限制
- ✅ SCENARIO-004：验证-证件号为空
- ✅ SCENARIO-005：验证-证件号长度不正确
- ✅ SCENARIO-006：验证-验证码为空
- ✅ SCENARIO-007：验证-验证码长度不正确
- ✅ SCENARIO-008：验证-验证码错误
- ✅ SCENARIO-009：验证-成功

**UI层设计**：

- 文件：`frontend/src/components/SmsVerificationModal.tsx` + `SmsVerificationModal.css`
- State管理：
  ```typescript
      const [idNumber, setIdNumber] = useState('');
      const [verificationCode, setVerificationCode] = useState('');
      const [countdown, setCountdown] = useState(0);
      const [message, setMessage] = useState<{type: 'error'|'success', text: string}>();
  ```




- 功能实现：
- 证件号输入框
- 验证码输入框 + 获取验证码按钮（倒计时）
- 所有9个scenarios的验证逻辑
- 错误/成功提示显示
- 遮罩层 + 居中弹窗
- CSS：复制 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 第6.3节样式
- 注册：`register_ui_component`
- `id`: UI-SMS-VERIFICATION
- `downstream_ids`: [API-SEND-SMS, API-VERIFY-SMS]

**API层设计1**：

- 文件：`backend/src/routes/api.js`
- 接口：`POST /api/auth/send-verification-code`
- 请求体：`{ username: string, idNumber: string }`
- 响应体：`{ success: boolean, message: string, code?: string }`
- 逻辑：调用 `FUNC-SEND-VERIFICATION-CODE`
- 注册：`register_api_endpoint`
- `id`: API-SEND-SMS
- `signature`: POST /api/auth/send-verification-code
- `downstream_ids`: [FUNC-SEND-VERIFICATION-CODE]

**API层设计2**：

- 接口：`POST /api/auth/verify-sms`
- 请求体：`{ username: string, idNumber: string, code: string }`
- 响应体：`{ success: boolean, message: string, token?: string }`
- 逻辑：调用 `FUNC-VERIFY-SMS-CODE`
- 注册：`register_api_endpoint`
- `id`: API-VERIFY-SMS
- `signature`: POST /api/auth/verify-sms
- `downstream_ids`: [FUNC-VERIFY-SMS-CODE]

**Logic层设计1**：

- 函数：`sendVerificationCode(username, idNumber)`
- 数据库操作：
- `SELECT` 验证用户和证件号
- `INSERT` 验证码到 verification_codes 表
- 注册：`register_backend_function`
- `id`: FUNC-SEND-VERIFICATION-CODE
- `db_tables`: [users, verification_codes]

**Logic层设计2**：

- 函数：`verifySmsCode(username, idNumber, code)`
- 数据库操作：
- `SELECT` 验证码记录
- 检查过期时间、验证码正确性
- `UPDATE` 用户登录状态
- 注册：`register_backend_function`
- `id`: FUNC-VERIFY-SMS-CODE
- `db_tables`: [verification_codes, users]

---

#### 需求5：REQ-LOGIN-PAGE（页面容器）

**UI层设计**：

- 文件：`frontend/src/pages/LoginPage.tsx` + `LoginPage.css`
- 内容：组合所有子组件
  ```tsx
      <div className="login-page-container">
        <TopNavigation />
        <div className="main-content">
          <div className="promotional-area">{/* 推广内容 */}</div>
          <LoginForm onLoginSuccess={() => setShowModal(true)} />
        </div>
        <BottomNavigation />
        {showModal && <SmsVerificationModal onClose={...} />}
      </div>
  ```




- CSS：复制 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 第2.3节样式
- 注册：`register_ui_component`
- `id`: UI-LOGIN-PAGE
- `children_slots`: [REQ-TOP-NAV, REQ-LOGIN-FORM, REQ-BOTTOM-NAV, REQ-SMS-VERIFICATION]

---

### 阶段三：配置文件

**1. 前端配置**

- `frontend/package.json`：添加依赖（react, typescript, axios, react-router-dom, vitest）
- `frontend/vite.config.ts`：配置代理 `/api` → `http://localhost:3000`

**2. 后端配置**

- `backend/package.json`：添加依赖（express, sqlite3, cors, body-parser, nodemon）
- `backend/src/database/init_db.js`：创建数据库表（users, verification_codes）

---

## 关键验证点

### 功能完整性

- [ ] REQ-LOGIN-FORM：6个scenarios全部实现
- [ ] REQ-SMS-VERIFICATION：9个scenarios全部实现
- [ ] 所有组件标注 `@scenarios_covered` 和 `@features_implemented`

### UI视觉还原

- [ ] 所有CSS从 [`requirements/ui-style-guide.md`](requirements/ui-style-guide.md) 复制
- [ ] 图片路径格式：`/images/文件名.扩展名`
- [ ] 布局位置与requirements一致（顶部导航→主内容→底部导航）

### 接口调用链

- [ ] UI-LOGIN-FORM → API-LOGIN → FUNC-AUTHENTICATE-USER
- [ ] UI-SMS-VERIFICATION → API-SEND-SMS → FUNC-SEND-VERIFICATION-CODE
- [ ] UI-SMS-VERIFICATION → API-VERIFY-SMS → FUNC-VERIFY-SMS-CODE

### 代码质量

- [ ] 所有代码可直接运行（不只是TODO注释）
- [ ] State管理完整（useState定义）
- [ ] 事件处理器完整（onClick、onChange）
- [ ] 错误处理完整（try-catch、错误提示）

---

## 预计工作量

- **需求数量**：5个（1个页面 + 4个组件）
- **UI组件**：5个 TSX + 5个 CSS 文件
- **API接口**：3个（login, send-sms, verify-sms）
- **后端函数**：3个
- **Scenarios覆盖**：15个（6 + 9）
- **预计工具调用数**：50-70次（读取文件、创建文件、注册接口）

---

## 成功标准

✅ 所有MCP注册工具调用成功✅ 接口ID闭环验证通过✅ 15个scenarios 100%覆盖