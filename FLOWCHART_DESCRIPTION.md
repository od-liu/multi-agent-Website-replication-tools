# UI 像素级调整 Agent 流程图描述

## 流程概述

基于迭代的UI像素级调整流程，通过视觉对比、差异识别、元素信息获取、代码修复和验证的循环过程，实现复刻页面与目标页面的像素级一致。

---

## 主要流程步骤

### 1. UI截图捕获

**输入**：
- 目标网址
- 前端网址

**操作**：
- 使用浏览器MCP工具对目标UI和当前复刻UI进行截图

**输出**：
- 目标UI界面截图
- 当前UI界面截图

---

### 2. 对比差异

**输入**：
- 目标UI界面截图
- 当前UI界面截图

**操作**：
- 视觉对比两张截图
- 识别并列出5个最明显的差异点

**输出**：
- 差异点列表（至少5处）

**关键要求**：
- 差异必须从视觉对比中获取，不能从代码分析中获取
- 优先识别明显的差异（颜色、尺寸、位置等）

---

### 3. 修复差异点

**输入**：
- 差异点列表

**操作**：对每个差异点执行以下步骤

#### 3.1 获取目标网站对应元素的信息
- 访问目标网站
- 获取对应元素的位置、大小、样式等信息
- 判断元素类型（文字或图片）

#### 3.2 下载缺失图片（如果需要）
- 如果差异点是缺失的图片元素
- 从目标网站下载图片资源
- 保存到项目资源目录

#### 3.3 修改CSS和TSX文件以尝试修复
- 根据获取的目标元素信息
- 修改CSS样式文件（调整位置、大小、颜色等）
- 修改TSX组件文件（调整结构、引用资源等）
- 考虑元素关联性，一并调整相关元素

**输出**：
- 修改后的代码文件
- 下载的资源文件（如有）

---

### 4. 验证是否修复完成

**输入**：
- 修改后的代码文件

**操作**：
- 保存代码修改
- 刷新前端页面
- 检查修复的元素是否已正确显示
- 检查相关元素是否也正确调整
- 确认没有引入新的问题

**输出**：
- 验证结果（已修复/部分修复/未修复）

---

### 5. 保存并刷新

**操作**：
- 保存所有文件修改
- 刷新浏览器页面
- 等待页面完全加载

**输出**：
- 页面已刷新状态

---

### 6. 更新迭代日志

**输入**：
- 迭代轮数
- 找出的差异点
- 修复的差异点
- 修改的文件列表
- 验证结果

**操作**：
- 记录本轮迭代的所有信息

**输出**：
- 更新后的迭代日志

---

### 7. 循环回到步骤1

**判断条件**：
- 如果迭代轮数 < 10：继续下一轮迭代
- 如果迭代轮数 >= 10 且剩余差异 < 5 且差异都很细微：终止迭代
- 否则：继续迭代

**操作**：
- 返回步骤1，开始新一轮迭代
- 重新截图当前UI界面
- 重复差异识别和修复流程

---

## 全程跟踪机制

**MCP任务跟踪**：
- 全程使用MCP工具跟踪进度和迭代轮数
- 每轮迭代开始前初始化跟踪
- 每个步骤完成后记录检查点
- 迭代完成后更新状态

---

## 流程图关键元素

### 主要节点
1. **开始**：流程开始
2. **UI截图捕获**：获取目标UI和当前UI截图
3. **对比差异**：视觉对比，列出5个明显差异点
4. **修复差异点**：包含三个子步骤的修复流程
   - 获取目标元素信息
   - 下载缺失图片（条件分支）
   - 修改代码文件
5. **验证修复**：检查修复效果
6. **保存并刷新**：应用修改
7. **更新迭代日志**：记录进度
8. **循环判断**：决定是否继续迭代
9. **结束**：流程结束

### 循环结构
- **主迭代循环**：从"对比差异"到"更新迭代日志"，然后循环回到"UI截图捕获"
- **差异点处理循环**：在"修复差异点"内部，逐个处理每个差异点

### 条件分支
- **图片下载分支**：如果差异点是缺失的图片，则下载图片
- **迭代终止分支**：根据迭代轮数和剩余差异数量决定是否继续

### 数据流
- **输入流**：目标网址、前端页面 → 截图 → 差异列表 → 元素信息 → 代码修改
- **输出流**：修改后的代码 → 验证结果 → 迭代日志 → 下一轮截图

---

## 流程图绘制建议

### 图形元素
- **矩形**：处理步骤（截图、对比、修复、验证等）
- **菱形**：判断节点（循环判断、条件分支）
- **椭圆形**：开始/结束节点
- **圆角矩形**：子流程（修复差异点的三个子步骤）
- **箭头**：流程方向和数据流

### 布局建议
- **左侧**：输入（目标网址、前端页面）
- **上方**：主流程（截图、对比、修复、验证）
- **中间**：修复差异点的详细子流程
- **右侧**：输出和循环判断
- **底部**：MCP跟踪机制说明

### 关键连接
- 从"更新迭代日志"有箭头指向"UI截图捕获"（循环）
- 从"保存并刷新"有箭头指向"UI截图捕获"（循环）
- "修复差异点"内部包含三个子步骤的流程
- "下载缺失图片"是条件分支（如果是图片才执行）
