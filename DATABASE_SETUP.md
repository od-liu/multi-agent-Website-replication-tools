# æ•°æ®åº“åˆå§‹åŒ–æŒ‡å—

æœ¬æ–‡æ¡£è¯´æ˜å¦‚ä½•åˆå§‹åŒ– 12306 é¡¹ç›®çš„æ•°æ®åº“ç³»ç»Ÿã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é¦–æ¬¡å¯åŠ¨é¡¹ç›®

å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨é¡¹ç›®ï¼Œéœ€è¦å…ˆåˆå§‹åŒ–æ•°æ®åº“ï¼š

```bash
cd backend
npm install
npm run setup-db
```

è¿™å°†ä¼šï¼š
- âœ… åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„æ•°æ®åº“è¡¨
- âœ… åˆ›å»ºæ¼”ç¤ºç”¨æˆ·ï¼ˆç”¨æˆ·åï¼š`demo`ï¼Œå¯†ç ï¼š`demo123`ï¼‰
- âœ… å¯¼å…¥è½¦æ¬¡æ•°æ®ï¼ˆä» `è½¦æ¬¡ä¿¡æ¯.json`ï¼‰
- âœ… ç”Ÿæˆæœªæ¥ 30 å¤©çš„ç­æ¬¡å’Œåº§ä½

### 2. å¯åŠ¨æœåŠ¡å™¨

æ•°æ®åº“åˆå§‹åŒ–å®Œæˆåï¼Œå¯åŠ¨åç«¯æœåŠ¡ï¼š

```bash
npm run dev
```

ç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯å¯åŠ¨å‰ç«¯ï¼š

```bash
cd frontend
npm install
npm run dev
```

## ğŸ“‹ è¯¦ç»†è¯´æ˜

### æ•°æ®åº“åˆå§‹åŒ–é€‰é¡¹

ä½ å¯ä»¥æŒ‡å®šç”Ÿæˆç­æ¬¡çš„å¤©æ•°ï¼š

```bash
# ç”Ÿæˆæœªæ¥ 7 å¤©çš„ç­æ¬¡
npm run setup-db:7

# ç”Ÿæˆæœªæ¥ 30 å¤©çš„ç­æ¬¡ï¼ˆé»˜è®¤ï¼‰
npm run setup-db:30

# è‡ªå®šä¹‰å¤©æ•°ï¼ˆä¾‹å¦‚ 60 å¤©ï¼‰
npm run setup-db -- 60
```

### æ‰‹åŠ¨åˆå§‹åŒ–æ­¥éª¤

å¦‚æœè‡ªåŠ¨åˆå§‹åŒ–å¤±è´¥ï¼Œå¯ä»¥æ‰‹åŠ¨æ‰§è¡Œå„ä¸ªæ­¥éª¤ï¼š

```bash
cd backend

# 1. åˆå§‹åŒ–åŸºç¡€è¡¨ç»“æ„
node src/database/init_db.js

# 2. è¿ç§»åº§ä½ç®¡ç†ç³»ç»Ÿ
node src/database/migrate_seat_system.js

# 3. å¯¼å…¥è½¦æ¬¡æ•°æ®
node src/database/import_train_data.js ../è½¦æ¬¡ä¿¡æ¯.json

# 4. ç”Ÿæˆç­æ¬¡å’Œåº§ä½
node src/database/generate_seats.js future 30
```

## ğŸ—‚ï¸ æ•°æ®åº“ç»“æ„

åˆå§‹åŒ–åçš„æ•°æ®åº“åŒ…å«ä»¥ä¸‹ä¸»è¦è¡¨ï¼š

### ç”¨æˆ·ç›¸å…³
- `users` - ç”¨æˆ·ä¿¡æ¯
- `verification_codes` - éªŒè¯ç 
- `sessions` - ä¼šè¯ç®¡ç†

### è½¦æ¬¡ç›¸å…³
- `trains` - è½¦æ¬¡åŸºæœ¬ä¿¡æ¯
- `stations` - ç«™ç‚¹ä¿¡æ¯
- `train_stops` - è½¦æ¬¡åœé ç«™
- `train_cars` - è½¦å¢é…ç½®
- `train_schedules` - ç­æ¬¡ä¿¡æ¯

### åº§ä½ç®¡ç†ï¼ˆV2 ç³»ç»Ÿï¼‰
- `schedule_seats` - å…·ä½“åº§ä½
- `seat_segments` - åº§ä½åŒºé—´é”å®š
- `train_segment_prices` - åˆ†æ®µç¥¨ä»·

### è®¢å•ç›¸å…³
- `orders` - è®¢å•ä¿¡æ¯
- `order_passengers` - è®¢å•ä¹˜å®¢ä¿¡æ¯
- `passengers` - ä¹˜å®¢ä¿¡æ¯

## ğŸ« åº§ä½ç±»å‹é…ç½®

ç³»ç»Ÿæ”¯æŒä»¥ä¸‹åº§ä½ç±»å‹ï¼š

### G/C å¼€å¤´è½¦æ¬¡ï¼ˆé«˜é“/åŸé™…ï¼‰
- å•†åŠ¡åº§
- ä¸€ç­‰åº§
- äºŒç­‰åº§

### D å¼€å¤´è½¦æ¬¡ï¼ˆåŠ¨è½¦ï¼‰
- è½¯å§
- ç¡¬å§
- äºŒç­‰åº§

## ğŸ“Š æ¼”ç¤ºæ•°æ®

åˆå§‹åŒ–åï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨åˆ›å»ºä»¥ä¸‹æ¼”ç¤ºæ•°æ®ï¼š

### æ¼”ç¤ºç”¨æˆ·
- **ç”¨æˆ·å**: `demo`
- **å¯†ç **: `demo123`
- **çœŸå®å§“å**: å¼ ä¸‰
- **è¯ä»¶å·**: 110101199001011234
- **æ‰‹æœºå·**: 13800138000

### æ¼”ç¤ºä¹˜å®¢
ç³»ç»Ÿä¼šä¸ºæ¼”ç¤ºç”¨æˆ·åˆ›å»º 2 ä¸ªå¸¸ç”¨ä¹˜å®¢ï¼š
1. å¼ ä¸‰ï¼ˆæˆäººï¼‰
2. æå››ï¼ˆå„¿ç«¥ï¼‰

## ğŸ”„ é‡ç½®æ•°æ®åº“

å¦‚æœéœ€è¦é‡ç½®æ•°æ®åº“ï¼ˆâš ï¸ ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰ï¼š

```bash
cd backend

# åˆ é™¤æ•°æ®åº“æ–‡ä»¶
rm database.db

# é‡æ–°åˆå§‹åŒ–
npm run setup-db
```

## âš ï¸ å¸¸è§é—®é¢˜

### é—®é¢˜1ï¼šæ•°æ®åº“æ–‡ä»¶æƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `EACCES: permission denied`

**è§£å†³æ–¹æ³•**:
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -l backend/database.db

# å¦‚æœæ²¡æœ‰å†™æƒé™ï¼Œæ·»åŠ æƒé™
chmod 644 backend/database.db
```

### é—®é¢˜2ï¼šè½¦æ¬¡ä¿¡æ¯æ–‡ä»¶ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯**: `è½¦æ¬¡ä¿¡æ¯.json æ–‡ä»¶ä¸å­˜åœ¨`

**è§£å†³æ–¹æ³•**:
- ç¡®ä¿ `è½¦æ¬¡ä¿¡æ¯.json` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
- å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå¯ä»¥ä»å¤‡ä»½æ¢å¤æˆ–è”ç³»é¡¹ç›®ç»´æŠ¤è€…

### é—®é¢˜3ï¼šåº§ä½æ•°é‡ä¸º 0

**åŸå› **: 
- è½¦å¢é…ç½®æœªæ­£ç¡®å¯¼å…¥
- åº§ä½ç”Ÿæˆå¤±è´¥

**è§£å†³æ–¹æ³•**:
```bash
# é‡æ–°ç”Ÿæˆåº§ä½
cd backend
node src/database/generate_seats.js future 30
```

### é—®é¢˜4ï¼šè½¯å§/ç¡¬å§ä½™ç¥¨æ˜¾ç¤ºä¸º 0

**åŸå› **: D å¼€å¤´è½¦æ¬¡çš„è½¦å¢é…ç½®ä¸æ­£ç¡®

**è§£å†³æ–¹æ³•**:
```bash
# é‡æ–°åˆå§‹åŒ–æ•°æ®åº“
cd backend
rm database.db
npm run setup-db
```

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“æ–‡ä»¶ä½ç½®**: `backend/database.db`
2. **å¤‡ä»½**: å»ºè®®åœ¨é‡ç½®å‰å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
3. **æ€§èƒ½**: ç”Ÿæˆå¤§é‡ç­æ¬¡å’Œåº§ä½å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´
4. **å­˜å‚¨ç©ºé—´**: 30 å¤©çš„æ•°æ®çº¦éœ€è¦ 20-50MB ç©ºé—´

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼š
1. æŸ¥çœ‹åç«¯æ—¥å¿—ï¼š`backend` ç»ˆç«¯çš„è¾“å‡º
2. æŸ¥çœ‹ README.md äº†è§£é¡¹ç›®æ¶æ„
3. è”ç³»é¡¹ç›®ç»´æŠ¤è€…

---

æœ€åæ›´æ–°ï¼š2026-01-20
